generator client {
  provider = "prisma-client-js"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum AnalysisRunStatus {
  queued
  running
  succeeded
  failed
  canceled
}

model AnalysisRun {
  id                 String            @id @default(cuid())
  status             AnalysisRunStatus @default(queued)

  referenceDatasetId String
  referenceDataset   ReferenceDataset  @relation(fields: [referenceDatasetId], references: [id])

  inputJson          Json
  resultJson         Json?
  errorMessage       String?

  algorithmVersion   String?
  modelVersion       String?

  startedAt          DateTime?
  finishedAt         DateTime?

  lockToken          String?
  lockedAt           DateTime?

  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}

model ReferenceDataset {
  id          String   @id @default(cuid())
  name        String   // png-modern など
  version     String   // v1, 2026-01-11 など
  description String?
  storageUri  String   // /data/reference/png-modern/v1/dataset.csv
  isActive    Boolean  @default(true)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  analysisRuns AnalysisRun[]

  @@unique([name, version])
}